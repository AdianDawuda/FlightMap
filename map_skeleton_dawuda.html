<!DOCTYPE html>

<head>
    <meta name="author" content="Adian Dawuda"/>
    <meta name="description" Content="Mobile Web Map"/>
    <meta charset="UTF-8">
    <title>Map - Adian Dawuda</title>
    <link rel="icon" type="image/x-icon" href="data/favicon.ico">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://openlayers.org/en/v5.3.0/css/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://openlayers.org/en/v5.3.0/build/ol.js" type="text/javascript"></script>
    <script type="text/javascript">
        function init() {
            const sbg_mercator = ol.proj.transform([13.06072, 47.78869], 'EPSG:4326', 'EPSG:3857');
            const cgn_mercator = ol.proj.transform([6.9583, 50.9413], 'EPSG:4326', 'EPSG:3857');

            const featureData = [{
                    coordinates: sbg_mercator,
                    name: 'Salzburg',
                    population: 156872,
                    imageSrc: 'data/burg1.gif',
                    size: 1.0
                },
                {
                    coordinates: cgn_mercator,
                    name: 'KÃ¶ln',
                    population: 1084831,
                    imageSrc: 'data/burg2.gif',
                    size: 0.35
                },
            ];

            for (const data of featureData) {
                drawMarker(data)
            }
            

            // Vector source and layer
            const vectorSource = new ol.source.Vector({
                features: features,
            });
            const vectorLayer = new ol.layer.Vector({
                source: vectorSource,
            });


            const rasterLayer = new ol.layer.Tile({
                source: new ol.source.OSM(),
            });

            const map = new ol.Map({
                layers: [rasterLayer, vectorLayer],
                target: document.getElementById('map'),
                controls: ol.control.defaults({
                    attributionOptions: ({
                        collapsible: false
                    })
                }).extend([new ol.control.ScaleLine()]),
                view: new ol.View({
                    center: sbg_mercator,
                    zoom: 10,
                }),
            });

            const element = document.getElementById('popup');

            const popup = new ol.Overlay({
                element: element,
                positioning: 'bottom-center',
                stopEvent: false,
            });
            map.addOverlay(popup);

            let popover;

            function disposePopover() {
                if (popover) {
                    popover.dispose();
                    popover = undefined;
                }
            }
            // display popup on click
            map.on('singleclick', function(evt) {
                const feature = map.forEachFeatureAtPixel(evt.pixel, function(feature) {
                    return feature;
                });
                disposePopover();
                if (!feature) {
                    return;
                }
                popup.setPosition(evt.coordinate);
                popover = new bootstrap.Popover(element, {
                    placement: 'top',
                    html: true,
                    content: feature.get('name') + '<br>Population: ' + feature.get('population'),
                });
                popover.show();
            });

            // change mouse cursor when over marker
            map.on('pointermove', function(e) {
                const pixel = map.getEventPixel(e.originalEvent);
                const hit = map.hasFeatureAtPixel(pixel);
                map.getTarget().style.cursor = hit ? 'pointer' : '';
            });
            // Close the popup when the map is moved
            map.on('movestart', disposePopover);

        }
        const features = [];
        function drawMarker(posMarker) { 
                
                const feature = new ol.Feature({
                    geometry: new ol.geom.Point(posMarker.coordinates),
                    name: posMarker.name,
                    population: posMarker.population,
                });
                const iconStyle = new ol.style.Style({
                    image: new ol.style.Icon({
                        anchor: [0.5, 46],
                        anchorXUnits: 'fraction',
                        anchorYUnits: 'pixels',
                        src: posMarker.imageSrc,
                        scale: posMarker.size,
                    }),
                });
                feature.setStyle(iconStyle);
                features.push(feature);
        }

    </script>
</head>

<body onload="init();">

<div id="header">
    <p>Web Map - Adian</p>
</div>

<div id="map">
    <div id="popup">

    </div>
</div>

<div id="footer">

</div>

</body>

</html>

